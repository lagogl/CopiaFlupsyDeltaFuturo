Ecco la struttura del database completa e dettagliata per gestire le ceste nei flupsy, includendo la tracciabilitÃ  dei movimenti, la gestione dei cicli e il monitoraggio biometrico degli animali.

ğŸ“Œ Struttura del Database
1ï¸âƒ£ Tabella Ceste (ceste)
Memorizza lâ€™elenco delle ceste e il loro stato attuale.

id_cesta (INT, PK) â†’ Numero progressivo della cesta (1-20)
attiva (BOOLEAN) â†’ Indica se la cesta Ã¨ attualmente in uso
ciclo_attuale (VARCHAR, FK) â†’ ID del ciclo attuale della cesta (se attiva)
2ï¸âƒ£ Tabella Flupsy (flupsy)
Identifica i flupsy disponibili.

id_flupsy (INT, PK) â†’ Identificativo univoco del flupsy
nome (VARCHAR) â†’ Nome del flupsy
3ï¸âƒ£ Tabella Cicli (cicli)
Registra la storia dei cicli di ogni cesta.

id_ciclo (VARCHAR, PK) â†’ Identificativo del ciclo (Formato: cesta+flupsy+YYMM)
id_cesta (FK) â†’ Riferimento alla cesta
id_flupsy (FK) â†’ Riferimento al flupsy
data_inizio (DATETIME) â†’ Data di prima attivazione
data_fine (DATETIME, NULL) â†’ Data di chiusura del ciclo (NULL se ancora attivo)
stato (ENUM: â€˜ATTIVOâ€™, â€˜CHIUSOâ€™) â†’ Stato del ciclo
4ï¸âƒ£ Tabella Movimenti (movimenti)
Registra tutti i movimenti delle ceste allâ€™interno del ciclo.

id_movimento (INT, PK, AUTO_INCREMENT)
id_ciclo (FK) â†’ Riferimento al ciclo attivo della cesta
data_movimento (DATETIME) â†’ Data e ora del movimento
posizione (INT) â†’ Numero di posizione occupata (1-10)
linea (ENUM: â€˜DESTRAâ€™, â€˜SINISTRAâ€™) â†’ Indica su quale fila si trova la cesta
tipo_operazione (VARCHAR) â†’ Es. â€˜Prima attivazioneâ€™, â€˜Spostamentoâ€™, â€˜Venditaâ€™, â€˜Selezione per venditaâ€™
numero_animali (INT) â†’ Numero totale di animali nella cesta al momento del movimento
animali_per_kg (DECIMAL(10,2)) â†’ Numero di animali per kg
peso_medio_mg (DECIMAL(10,2), GENERATED) â†’ Calcolato come (1000000 / animali_per_kg)
5ï¸âƒ£ Tabella Taglie (taglie)
Definisce i range di riferimento per le taglie degli animali.

id_taglia (INT, PK)
descrizione (VARCHAR) â†’ Nome della taglia (es. â€˜Smallâ€™, â€˜Mediumâ€™, â€˜Largeâ€™)
min_animali_per_kg (DECIMAL(10,2)) â†’ Valore minimo per la taglia
max_animali_per_kg (DECIMAL(10,2)) â†’ Valore massimo per la taglia
6ï¸âƒ£ Tabella Storico Posizioni (storico_posizioni)
Traccia lâ€™intera storia delle posizioni della cesta.

id_storico (INT, PK, AUTO_INCREMENT)
id_cesta (FK) â†’ Riferimento alla cesta
id_ciclo (FK) â†’ Riferimento al ciclo associato
data_movimento (DATETIME) â†’ Data e ora dello spostamento
posizione (INT) â†’ Numero di posizione
linea (ENUM: â€˜DESTRAâ€™, â€˜SINISTRAâ€™)
ğŸ”¹ Funzionamento del Sistema
âœ… Attivazione di un nuovo ciclo
Viene registrata unâ€™operazione con causale â€˜Prima attivazioneâ€™.
Si genera un nuovo id_ciclo e si lega alla cesta.
La cesta viene associata a una posizione iniziale (Destra/Sinistra).
ğŸ”„ Movimenti della cesta
Ogni spostamento viene registrato in movimenti con data, posizione e numero di animali.
Il sistema calcola il peso medio e lo confronta con la tabella taglie.
Viene aggiornata la tabella storico_posizioni.
ğŸ”š Chiusura del ciclo
Quando viene registrato un movimento con causale â€˜Venditaâ€™ o â€˜Selezione per venditaâ€™, il ciclo viene chiuso.
data_fine viene valorizzata e stato cambia a â€˜CHIUSOâ€™.
La cesta Ã¨ pronta per un nuovo ciclo in futuro.